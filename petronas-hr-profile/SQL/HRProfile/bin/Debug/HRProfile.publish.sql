/*
Deployment script for HRProfile

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "HRProfile"
:setvar DefaultFilePrefix "HRProfile"
:setvar DefaultDataPath ""
:setvar DefaultLogPath ""

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
IF EXISTS (SELECT 1
           FROM   [sys].[databases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ANSI_NULLS ON,
                ANSI_PADDING ON,
                ANSI_WARNINGS ON,
                ARITHABORT ON,
                CONCAT_NULL_YIELDS_NULL ON,
                QUOTED_IDENTIFIER ON,
                ANSI_NULL_DEFAULT ON 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [sys].[databases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ALLOW_SNAPSHOT_ISOLATION OFF;
    END


GO
PRINT N'Creating Schema [Audit]...';


GO
CREATE SCHEMA [Audit]
    AUTHORIZATION [dbo];


GO
PRINT N'Creating Schema [Master]...';


GO
CREATE SCHEMA [Master]
    AUTHORIZATION [dbo];


GO
PRINT N'Creating Table [Master].[Role]...';


GO
CREATE TABLE [Master].[Role] (
    [RoleID]            INT            NOT NULL,
    [RoleName]          VARCHAR (50)   NOT NULL,
    [RoleCode]          VARCHAR (20)   NOT NULL,
    [ActiveFlag]        BIT            NOT NULL,
    [CreatedBy]         NVARCHAR (200) NOT NULL,
    [CreatedTimestamp]  DATETIME       NOT NULL,
    [ModifiedBy]        NVARCHAR (200) NULL,
    [ModifiedTimestamp] DATETIME       NOT NULL,
    CONSTRAINT [PK_Role_RoleID] PRIMARY KEY CLUSTERED ([RoleID] ASC),
    CONSTRAINT [UC_Role_RoleCode] UNIQUE NONCLUSTERED ([RoleCode] ASC)
);


GO
PRINT N'Creating Table [Master].[User]...';


GO
CREATE TABLE [Master].[User] (
    [UserID]            INT            NOT NULL,
    [EmailID]           NVARCHAR (200) NOT NULL,
    [FirstName]         NVARCHAR (50)  NOT NULL,
    [LastName]          NVARCHAR (50)  NOT NULL,
    [ActiveFlag]        BIT            NOT NULL,
    [CreatedBy]         NVARCHAR (200) NOT NULL,
    [CreatedTimestamp]  DATETIME       NOT NULL,
    [ModifiedBy]        NVARCHAR (200) NULL,
    [ModifiedTimestamp] DATETIME       NOT NULL,
    CONSTRAINT [PK_User_UserID] PRIMARY KEY CLUSTERED ([UserID] ASC),
    CONSTRAINT [UC_User_EmailID] UNIQUE NONCLUSTERED ([EmailID] ASC)
);


GO
PRINT N'Creating Table [Master].[EmailTemplate]...';


GO
CREATE TABLE [Master].[EmailTemplate] (
    [EmailTemplateID]   INT             NOT NULL,
    [EmailTemplateName] VARCHAR (50)    NOT NULL,
    [EmailTemplateCode] VARCHAR (20)    NOT NULL,
    [EmailSubject]      NVARCHAR (1000) NOT NULL,
    [EmailBody]         NVARCHAR (MAX)  NOT NULL,
    [EmailSeverity]     VARCHAR (20)    NULL,
    [ActiveFlag]        BIT             NOT NULL,
    [CreatedBy]         NVARCHAR (200)  NOT NULL,
    [CreatedTimestamp]  DATETIME        NOT NULL,
    [ModifiedBy]        NVARCHAR (200)  NULL,
    [ModifiedTimestamp] DATETIME        NOT NULL,
    CONSTRAINT [PK_EmailTemplate_UserID] PRIMARY KEY CLUSTERED ([EmailTemplateID] ASC),
    CONSTRAINT [UC_EmailTemplate_EmailTemplateCode] UNIQUE NONCLUSTERED ([EmailTemplateCode] ASC)
);


GO
PRINT N'Creating Table [Master].[UserRole]...';


GO
CREATE TABLE [Master].[UserRole] (
    [UserID]            INT            NOT NULL,
    [RoleID]            INT            NOT NULL,
    [ActiveFlag]        BIT            NOT NULL,
    [CreatedBy]         NVARCHAR (200) NOT NULL,
    [CreatedTimestamp]  DATETIME       NOT NULL,
    [ModifiedBy]        NVARCHAR (200) NULL,
    [ModifiedTimestamp] DATETIME       NOT NULL,
    CONSTRAINT [PK_UserRole_UserID_RoleID] PRIMARY KEY CLUSTERED ([UserID] ASC, [RoleID] ASC)
);


GO
PRINT N'Creating Table [dbo].[Batch]...';


GO
CREATE TABLE [dbo].[Batch] (
    [BatchID]                      INT            NOT NULL,
    [BatchName]                    VARCHAR (50)   NOT NULL,
    [SubmittedBy]                  NVARCHAR (200) NOT NULL,
    [SubmittedTimeStamp]           DATETIME       NOT NULL,
    [BatchType]                    VARCHAR (25)   NOT NULL,
    [EndUserCreatedBy]             NVARCHAR (200) NULL,
    [EndUserCreatedTimestamp]      DATETIME       NULL,
    [EndUserModifiedBy]            NVARCHAR (200) NULL,
    [EndUserModifiedTimestamp]     DATETIME       NULL,
    [BackendUserModifiedBy]        NVARCHAR (200) NULL,
    [BackendUserModifiedTimestamp] DATETIME       NULL,
    CONSTRAINT [PK_Batch_BatchID] PRIMARY KEY CLUSTERED ([BatchID] ASC)
);


GO
PRINT N'Creating Table [dbo].[SPUR]...';


GO
CREATE TABLE [dbo].[SPUR] (
    [SPURID]                          INT            NOT NULL,
    [SPURName]                        VARCHAR (100)  NOT NULL,
    [JobCOde]                         VARCHAR (50)   NULL,
    [EffectiveStartDate]              DATETIME       NULL,
    [EffectiveEndDate]                DATETIME       NULL,
    [RoleLevel]                       VARCHAR (100)  NULL,
    [MinimumExperienceRequiredInYear] NUMERIC (3, 2) NULL,
    [DesiredExperienceInYear]         NUMERIC (3, 2) NULL,
    [Industry]                        VARCHAR (100)  NULL,
    [Domain]                          VARCHAR (100)  NULL,
    [ContentItem]                     VARCHAR (100)  NULL,
    [AreaOfStudy]                     VARCHAR (100)  NULL,
    [OtherAreaOfStudy]                VARCHAR (100)  NULL,
    [LicenseAndCertificate]           VARCHAR (100)  NULL,
    [OtherLicnseAndCertificate]       VARCHAR (100)  NULL,
    [Membership]                      VARCHAR (100)  NULL,
    [OtherMembership]                 VARCHAR (100)  NULL,
    [Status]                          VARCHAR (20)   NULL,
    [BatchID]                         INT            NULL,
    [ApproverEmailID]                 NVARCHAR (200) NULL,
    [ActiveFlag]                      BIT            NULL,
    [SubmittedTimeStamp]              DATETIME       NULL,
    [EndUserCreatedBy]                NVARCHAR (200) NULL,
    [EndUserCreatedTimestamp]         DATETIME       NULL,
    [EndUserModifiedBy]               NVARCHAR (200) NULL,
    [EndUserModifiedTimestamp]        DATETIME       NULL,
    [BackendUserModifiedBy]           NVARCHAR (200) NULL,
    [BackendUserModifiedTimestamp]    DATETIME       NULL,
    CONSTRAINT [PK_SPUR_SPURID] PRIMARY KEY CLUSTERED ([SPURID] ASC)
);


GO
PRINT N'Creating Default Constraint [Master].[DC_Role_ActiveFlag]...';


GO
ALTER TABLE [Master].[Role]
    ADD CONSTRAINT [DC_Role_ActiveFlag] DEFAULT (1) FOR [ActiveFlag];


GO
PRINT N'Creating Default Constraint [Master].[DC_Role_ModifiedTimeStamp]...';


GO
ALTER TABLE [Master].[Role]
    ADD CONSTRAINT [DC_Role_ModifiedTimeStamp] DEFAULT (GETUTCDATE()) FOR [ModifiedTimestamp];


GO
PRINT N'Creating Default Constraint [Master].[DC_User_ActiveFlag]...';


GO
ALTER TABLE [Master].[User]
    ADD CONSTRAINT [DC_User_ActiveFlag] DEFAULT (1) FOR [ActiveFlag];


GO
PRINT N'Creating Default Constraint [Master].[DC_User_ModifiedTimeStamp]...';


GO
ALTER TABLE [Master].[User]
    ADD CONSTRAINT [DC_User_ModifiedTimeStamp] DEFAULT (GETUTCDATE()) FOR [ModifiedTimestamp];


GO
PRINT N'Creating Default Constraint [Master].[DC_EmailTemplate_ActiveFlag]...';


GO
ALTER TABLE [Master].[EmailTemplate]
    ADD CONSTRAINT [DC_EmailTemplate_ActiveFlag] DEFAULT (1) FOR [ActiveFlag];


GO
PRINT N'Creating Default Constraint [Master].[DC_EmailTemplate_ModifiedTimeStamp]...';


GO
ALTER TABLE [Master].[EmailTemplate]
    ADD CONSTRAINT [DC_EmailTemplate_ModifiedTimeStamp] DEFAULT (GETUTCDATE()) FOR [ModifiedTimestamp];


GO
PRINT N'Creating Default Constraint [Master].[DC_UserRole_ActiveFlag]...';


GO
ALTER TABLE [Master].[UserRole]
    ADD CONSTRAINT [DC_UserRole_ActiveFlag] DEFAULT (1) FOR [ActiveFlag];


GO
PRINT N'Creating Default Constraint [Master].[DC_UserRole_ModifiedTimeStamp]...';


GO
ALTER TABLE [Master].[UserRole]
    ADD CONSTRAINT [DC_UserRole_ModifiedTimeStamp] DEFAULT (GETUTCDATE()) FOR [ModifiedTimestamp];


GO
PRINT N'Creating Foreign Key [Master].[FK_User_UserRole_UserID]...';


GO
ALTER TABLE [Master].[UserRole] WITH NOCHECK
    ADD CONSTRAINT [FK_User_UserRole_UserID] FOREIGN KEY ([UserID]) REFERENCES [Master].[User] ([UserID]);


GO
PRINT N'Creating Foreign Key [Master].[FK_Role_UserRole_RoleID]...';


GO
ALTER TABLE [Master].[UserRole] WITH NOCHECK
    ADD CONSTRAINT [FK_Role_UserRole_RoleID] FOREIGN KEY ([RoleID]) REFERENCES [Master].[Role] ([RoleID]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_Batch_SPUR_BatchID]...';


GO
ALTER TABLE [dbo].[SPUR] WITH NOCHECK
    ADD CONSTRAINT [FK_Batch_SPUR_BatchID] FOREIGN KEY ([BatchID]) REFERENCES [dbo].[Batch] ([BatchID]);


GO
